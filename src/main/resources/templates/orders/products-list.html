<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Order Management</title>
    <link th:href="@{/css/styles.css}" rel="stylesheet"/>
    <link th:href="@{'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css'}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body>
<div class="container mt-4">
    <div>
        <a th:href="@{/}" class="home-button">
            <i class="bi bi-house-door me-2"></i>HOME
        </a>
    </div>
    <h1>Order Management</h1>

    <!-- Error Messages -->
    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show">
        <span th:text="${error}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <!-- Filter Section -->
    <div class="filter-section">
        <form th:action="@{/orders/products-list}" method="get" class="row g-3">
            <div class="col-md-3">
                <label for="minPrice" class="form-label">Min Price</label>
                <input type="number" class="form-control" id="minPrice" name="minPrice"
                       th:value="${param.minPrice}" step="0.01" min="0">
            </div>
            <div class="col-md-3">
                <label for="maxPrice" class="form-label">Max Price</label>
                <input type="number" class="form-control" id="maxPrice" name="maxPrice"
                       th:value="${param.maxPrice}" step="0.01" min="0">
            </div>
            <div class="col-md-3">
                <label for="category" class="form-label">Category</label>
                <select class="form-select" id="category" name="categoryId">
                    <option value="">All Categories</option>
                    <option th:each="category : ${categories}"
                            th:value="${category.id}"
                            th:text="${category.name}"
                            th:selected="${param.categoryId != null and param.categoryId[0] == category.id.toString()}">
                    </option>
                </select>
            </div>
            <div class="col-md-3 d-flex align-items-end">
                <button type="submit" class="btn btn-primary me-2">Filter</button>
                <a th:href="@{/orders/products-list}" class="btn btn-outline-secondary">Reset</a>
            </div>
        </form>

        <!-- top-sellers -->
        <div class="mt-3">
            <a th:href="@{/orders/top-sellers}" class="btn btn-info me-2">
                Top 5 Sellers
            </a>
        </div>
    </div>

    <!-- Products Table with Selection Form -->
    <form th:action="@{/orders/cart}" method="post" id="productSelectionForm">
        <div class="table-responsive">
            <div class="text-end mt-3">
                <button type="submit" class="btn btn-success" style="margin-bottom: 15px; width: 200px;">Go to Cart </button>
            </div>
            <table class="table table-hover table-striped">
                <thead class="table-dark">
                <tr>
                    <th>Quantity</th>
                    <th>Name</th>
                    <th>Category</th>
                    <th>Price</th>
                    <th>Description</th>
                </tr>
                </thead>
                <tbody>
                <tr th:if="${#lists.isEmpty(products)}">
                    <td colspan="5" class="text-center text-muted">No products found</td>
                </tr>
                <tr th:each="product, stat : ${products}" th:unless="${#lists.isEmpty(products)}">
                    <td>
                        <input type="number" name="quantities" th:value="0" min="0" class="form-control form-control-sm" style="width: 70px;">
                        <input type="hidden" name="productIds" th:value="${product.id}">
                    </td>
                    <td th:text="${product.name}"></td>
                    <td th:text="${product.category.name}"></td>
                    <td th:text="${'$' + product.price}"></td>
                    <td class="description-cell" th:text="${product.description}"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!--to check that there is at least one product has quantity >0-->
<script>

    document.getElementById('productSelectionForm').addEventListener('submit', function (e) {
        const quantityInputs = document.querySelectorAll('input[type="number"]');
        let hasQuantity = false;

        quantityInputs.forEach(input => {
            if (parseInt(input.value) > 0) {
                hasQuantity = true;
            }
        });

        if (!hasQuantity) {
            e.preventDefault();
            alert('Please enter a quantity greater than 0 for at least one product');
        }
    });
</script>
</body>
</html>